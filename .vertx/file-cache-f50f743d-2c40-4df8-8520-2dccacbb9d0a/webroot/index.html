<html>
<head>
</head>
<body>

<h1>Politrons Vertx Server</h1>

<div id="addUser">
    <h3>User</h3>
    <input type="hidden" id="inputUserId" type="text"/>

    <p><label id="inputUserNameLabel" type="text">User name<input id="inputUserName" type="text"/></label></p>

    <p><label id="inputUserEmailLabel" type="text">Email<input id="inputUserEmail" type="text"/></label></p>

    <p><label id="inputUserFullnameLabel" type="text">Full name<input id="inputUserFullname" type="text"/></label></p>

    <p><label id="inputUserAgeLabel" type="text">Age<input id="inputUserAge" type="text"/></label></p>

    <p><label id="inputUserLocationLabel" type="text">Location<input id="inputUserLocation" type="text"/></label></p>

    <p><label id="inputUserGenderLabel" type="text">Gender<input id="inputUserGender" type="text"/></label></p>

    <p>
        <input type="button" id="addUserButtonId" value="Add"/>
        <input type="button" id="busAddUserButtonId" value="Add by Bus"/>
        <input type="button" id="busUpdateUserButtonId" value="Update by Bus"/>

    </p>
</div>

<div id="search">
    <h3>Search user</h3>
    <input id="inputSearchBy" type="text"/>
    <select id="searchBy">
        <option value="username">Username</option>
        <option value="email">Email</option>
        <option value="age">Age</option>
    </select>
    <input type="button" id="searchByButton" value="search"/>
    <input type="button" id="busSearchByButton" value="search by bus"/>
</div>

<div id="userList">
    <table>
        <thead>
        <th>
            Name
        </th>
        <th>
            Email
        </th>
        <th>
            Action
        </th>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<p id="demo"></p>

<button onclick="getInitialPosition()">Mark position</button>
<button onclick="getDistance()">Start</button>
<button onclick="stopTracking()">Stop</button>


</body>
</html>
<script src="js/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js"></script>
<script src="js/vertxbus.js"></script>
<script src="js/index.js"></script>


<script>
    var startPosition;
    var x = document.getElementById("demo");
    var stop=false;

    function stopTracking(){
        stop=true;
    }

    function getInitialPosition() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(saveInitialPosition);
        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function saveInitialPosition(position) {
        startPosition = {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude
        };
    }

    function getDistance() {
        setInterval(function () {
            if(stop){
                return;
            }
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showDistance);
            } else {
                x.innerHTML = "Geolocation is not supported by this browser!.";
            }
        }, 1);

    }
    function showDistance(position) {
        var currentPosition = {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude
        };
        x.innerHTML = "Distance: " + calculateDistance(startPosition,currentPosition);
    }


    /*Function to calculate distance between two coordinates on earth surface*/
    function calculateDistance(startPosition, currentPosition) {
        var startLatRads = degreesToRadians(startPosition.latitude);
        var startLongRads = degreesToRadians(startPosition.longitude);
        var destLatRads = degreesToRadians(currentPosition.latitude);
        var destLongRads = degreesToRadians(currentPosition.longitude);
        var Radius = 6371; // radius of the Earth in metres
        var distance = Math.acos(Math.sin(startLatRads) * Math.sin(destLatRads) +
                        Math.cos(startLatRads) * Math.cos(destLatRads) *
                        Math.cos(startLongRads - destLongRads)) * Radius;
        return distance;
    }

    /*Converts degree to radians*/
    function degreesToRadians(degrees) {
        var radians = (degrees * Math.PI)/180;
        return radians;
    }


</script>